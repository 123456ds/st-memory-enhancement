# 记忆插件数据对接教程

本教程将指导您如何通过本插件提供的多种方式，来获取和使用表格数据，以实现丰富的自定义交互。

## 方式一：通过API函数获取数据

本插件提供了两个全局JavaScript函数，供其他插件或高级用户在脚本中调用。

### 1. `ext_getAllTables()` - 获取简洁格式的数据

这个函数以易于处理的数组格式，返回所有当前加载的表格。

*   **返回值**：一个对象数组，每个对象代表一个表格，包含 `name` 和 `data` (一个包含表头和所有数据行的二维数组)。

*   **示例**：
    ```javascript
    if (window.stMemoryEnhancement && window.stMemoryEnhancement.ext_getAllTables) {
        const tables = window.stMemoryEnhancement.ext_getAllTables();
        console.log(tables);
        // [
        //   { name: "角色列表", data: [["ID", "姓名"], ["1", "爱丽丝"]] },
        //   { name: "物品清单", data: [["ID", "名称"], ["W01", "治疗药水"]] }
        // ]
    }
    ```

### 2. `ext_exportAllTablesAsJson()` - 获取精简版的JSON格式数据

这个函数返回一个与“导出表格”功能格式一致的精简版JSON对象，是与自定义模板（如 `原版美化.html`）对接的**推荐方式**。

*   **返回值**：一个对象，键是表格的唯一ID (UID)，值是包含该表格核心属性（`uid`, `name`, `content`）的对象。

*   **详细示例**：
    ```javascript
    if (window.stMemoryEnhancement && window.stMemoryEnhancement.ext_exportAllTablesAsJson) {
        const rawTables = window.stMemoryEnhancement.ext_exportAllTablesAsJson();
        
        // 现在 rawTables 包含了所有表格的精简数据
        console.log(rawTables);
        // 输出示例:
        // {
        //   "sheet_d3rd64sK": { 
        //     "uid": "sheet_d3rd64sK", 
        //     "name": "主角信息", 
        //     "content": [
        //       ["", "人物名称", "当前状态"],
        //       ["", "陈默", "犹豫不决"]
        //     ] 
        //   },
        //   "sheet_Swh3TwVB": { 
        //     "uid": "sheet_Swh3TwVB", 
        //     "name": "全局数据表", 
        //     "content": [
        //       ["", "地图标题", "当前时间"],
        //       ["", "璃城市", "2025年"]
        //     ]
        //   }
        // }
    }
    ```

---

## 方式二：通过宏在前端渲染数据

您可以在任何聊天消息或HTML模板中，使用以下宏来动态地显示表格数据。这些宏会在内容显示在屏幕上时被自动解析和替换。

### 1. `{{GET::表格名:单元格地址}}` - 获取单个单元格数据

这个宏用于获取并显示单个单元格的值。

*   **语法**: `{{GET::表格名称:单元格地址}}`
*   **示例**:
    *   输入: `我的名字是 {{GET::主角信息:B2}}`
    *   显示: `我的名字是 陈默`

### 2. `{{GET_ALL_TABLES_JSON}}` - 获取所有表格的精简JSON数据

这个宏是**最常用**的对接方式，它用于一次性注入所有表格的精简版JSON数据，通常用于需要用JavaScript进行复杂数据处理的自定义模板中。

*   **语法**: `{{GET_ALL_TABLES_JSON}}`
*   **详细示例**: 在 `原版美化.html` 这样的模板中，您可以这样使用：
    ```html
    <script>
        // 当宏被解析时，{{GET_ALL_TABLES_JSON}} 会被替换成一个完整的JSON字符串。
        // JavaScript会将其解析为一个对象，并赋值给 tableData。
        const tableData = {{GET_ALL_TABLES_JSON}};

        // 现在 'tableData' 是一个包含了所有表格精简信息的JSON对象，
        // 您可以像原版代码一样，用 processJsonData(tableData) 来处理它。
        function processAndRender(data) {
            // 在这里编写您的数据处理和渲染逻辑
            // 例如，提取特定表格的数据：
            const protagonistInfo = data['sheet_d3rd64sK'];
            if (protagonistInfo) {
                document.getElementById('character-name').textContent = protagonistInfo.content[1][1]; // 获取主角姓名
            }
        }
        
        // 在文档加载完成后，使用获取到的数据进行初始化
        document.addEventListener('DOMContentLoaded', () => {
            processAndRender(tableData);
        });
    </script>
